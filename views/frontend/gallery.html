<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Gallery | Power Sanctuary</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #050a18; 
      --accent: #c5a059;  
      --bg: #f4f7fa;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--primary); min-height: 100vh; }

    nav {
      background: var(--primary); padding: 20px 8%;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 1000;
    }
    .logo-text h1 { font-family: 'Playfair Display', serif; color: var(--accent); font-size: 1.4rem; }

    .gallery-header { text-align: center; padding: 50px 20px; background: var(--primary); color: white; }
    .gallery-header h2 { font-family: 'Playfair Display', serif; color: var(--accent); font-size: 2.2rem; }

    /* --- IMPROVED GRID --- */
    .gallery-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px; padding: 40px 8%;
    }

    .gallery-card {
      background: white; border-radius: 15px; overflow: hidden;
      box-shadow: 0 10px 20px rgba(0,0,0,0.05); transition: 0.3s;
      border: 1px solid #eee;
    }
    .gallery-card:hover { transform: translateY(-5px); }

    .img-box { position: relative; width: 100%; height: 250px; background: #eee; }
    .img-box img { width: 100%; height: 100%; object-fit: cover; display: block; }

    /* --- LABELS & BUTTONS --- */
    .card-info { padding: 15px; text-align: center; }
    .card-info h4 { font-size: 0.95rem; margin-bottom: 12px; color: var(--primary); }

    .action-row { display: flex; justify-content: center; gap: 15px; border-top: 1px solid #f0f0f0; padding-top: 15px; }
    
    .btn-view { color: var(--primary); text-decoration: none; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; cursor: pointer; border: none; background: none; }
    .btn-save { color: #b48a3d; text-decoration: none; font-size: 0.85rem; font-weight: 700; display: flex; align-items: center; gap: 5px; cursor: pointer; border: none; background: none; }

    /* --- LIGHTBOX --- */
    #lightbox {
      position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9);
      display:none; justify-content:center; align-items:center; z-index:2000;
    }
    #lightbox img { max-width: 90%; max-height: 80%; border-radius: 10px; }
    .close-light { position: absolute; top: 20px; right: 30px; color: white; font-size: 2rem; cursor: pointer; }
  </style>
</head>
<body>

  <nav>
    <div class="logo-text"><h1>POWER SANCTUARY</h1></div>
  </nav>

  <header class="gallery-header">
    <h2>Church Media Gallery</h2>
    <p>View and save moments of glory</p>
  </header>

  <div class="gallery-grid" id="galleryContainer">
    </div>

  <div id="lightbox" onclick="this.style.display='none'">
    <span class="close-light">&times;</span>
    <img id="lightImg" src="">
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDew-adannENogn9S01WB5QY10Q11eJAy0",
      authDomain: "rccgpowersanctuaryarea.firebaseapp.com",
      projectId: "rccgpowersanctuaryarea",
      storageBucket: "rccgpowersanctuaryarea.firebasestorage.app",
      messagingSenderId: "189635943022",
      appId: "1:189635943022:web:daa6cace786eb3de9a247f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // VIEW LOGIC
    function viewImage(url) {
      document.getElementById('lightImg').src = url;
      document.getElementById('lightbox').style.display = 'flex';
    }

    // DOWNLOAD LOGIC
    async function downloadImage(url, title) {
      try {
        const res = await fetch(url);
        const blob = await res.blob();
        const bUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = bUrl;
        a.download = `PowerSanctuary-${title.replace(/\s+/g, '-')}.jpg`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) { window.open(url, '_blank'); }
    }

    // LOAD FROM FIREBASE
    db.collection("church_gallery").orderBy("timestamp", "desc").onSnapshot(snap => {
      const container = document.getElementById('galleryContainer');
      container.innerHTML = snap.docs.map(doc => {
        const photo = doc.data();
        const cap = photo.cap || "Blessing";
        return `
          <div class="gallery-card">
            <div class="img-box">
              <img src="${photo.url}" alt="${cap}" loading="lazy">
            </div>
            <div class="card-info">
              <h4>${cap}</h4>
              <div class="action-row">
                <button class="btn-view" onclick="viewImage('${photo.url}')">
                  <i class="fa fa-eye"></i> View
                </button>
                <button class="btn-save" onclick="downloadImage('${photo.url}', '${cap}')">
                  <i class="fa fa-download"></i> Save to Device
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    });
  </script>
</body>
  </html>
