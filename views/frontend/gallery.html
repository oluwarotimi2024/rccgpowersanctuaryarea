<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Gallery | Power Sanctuary</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #050a18; 
      --accent: #c5a059;  
      --white: #ffffff;
      --bg: #f4f7fa;
      --footer-bg: #0a0f1d;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--primary); display: flex; flex-direction: column; min-height: 100vh; }

    /* --- NAVIGATION --- */
    nav {
      background: var(--primary); padding: 20px 8%;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 1000;
    }
    .logo-text h1 { font-family: 'Playfair Display', serif; color: var(--accent); font-size: 1.4rem; letter-spacing: 1px; }
    .nav-menu { display: flex; list-style: none; gap: 20px; }
    .nav-menu a { color: white; text-decoration: none; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; transition: 0.3s; }
    .nav-menu a:hover, .nav-menu a.active { color: var(--accent); }

    /* --- GALLERY HEADER --- */
    .gallery-header {
      text-align: center; padding: 60px 20px;
      background: linear-gradient(rgba(5, 10, 24, 0.8), rgba(5, 10, 24, 0.8)), url('https://images.unsplash.com/photo-1444212477490-ca407925329e?auto=format&fit=crop&w=1500&q=80');
      background-size: cover; background-position: center; color: white;
    }
    .gallery-header h2 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--accent); margin-bottom: 10px; }

    /* --- GALLERY GRID --- */
    .gallery-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px; padding: 60px 8%; flex: 1;
    }
    .gallery-item {
      background: white; border-radius: 12px; overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: 0.4s;
    }
    .gallery-item:hover { transform: translateY(-10px); }
    .gallery-item img { width: 100%; height: 250px; object-fit: cover; display: block; cursor: pointer; }

    .item-footer {
      padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
    }
    .item-footer span { font-weight: 600; font-size: 0.9rem; color: var(--primary); }

    /* --- ACTION BUTTONS --- */
    .btn-group { display: flex; gap: 8px; }
    .btn-action {
      background: var(--bg); color: var(--primary);
      width: 36px; height: 36px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      text-decoration: none; transition: 0.3s; border: none; cursor: pointer;
    }
    .btn-action:hover { background: var(--accent); color: white; }

    /* --- LIGHTBOX POPUP --- */
    #lightbox {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); display: none; justify-content: center;
      align-items: center; z-index: 2000; flex-direction: column;
    }
    #lightbox img { max-width: 90%; max-height: 80%; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    #lightbox .close-btn { position: absolute; top: 20px; right: 30px; color: white; font-size: 2rem; cursor: pointer; }

    footer { background: var(--footer-bg); color: #94a3b8; padding: 40px 8%; text-align: center; }
  </style>
</head>
<body>

  <nav>
    <div class="logo-text"><h1>POWER SANCTUARY</h1></div>
    <ul class="nav-menu">
      <li><a href="index.html">Home</a></li>
      <li><a href="live.html">Live</a></li>
      <li><a href="gallery.html" class="active">Gallery</a></li>
      <li><a href="prayer.html">Prayer</a></li>
    </ul>
  </nav>

  <header class="gallery-header">
    <h2>Church Media Gallery</h2>
    <p>View and download moments from our services.</p>
  </header>

  <div class="gallery-grid" id="galleryContainer"></div>

  <div id="lightbox" onclick="closeLightbox()">
    <span class="close-btn">&times;</span>
    <img id="lightboxImg" src="">
    <p id="lightboxCap" style="color: white; margin-top: 15px; font-weight: 600;"></p>
  </div>

  <footer>
    <p>&copy; 2025 Power Sanctuary Area HQ. All Rights Reserved.</p>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDew-adannENogn9S01WB5QY10Q11eJAy0",
      authDomain: "rccgpowersanctuaryarea.firebaseapp.com",
      projectId: "rccgpowersanctuaryarea",
      storageBucket: "rccgpowersanctuaryarea.firebasestorage.app",
      messagingSenderId: "189635943022",
      appId: "1:189635943022:web:daa6cace786eb3de9a247f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 1. LIGHTBOX FUNCTIONS
    function openLightbox(url, cap) {
      document.getElementById('lightboxImg').src = url;
      document.getElementById('lightboxCap').innerText = cap;
      document.getElementById('lightbox').style.display = 'flex';
    }
    function closeLightbox() { document.getElementById('lightbox').style.display = 'none'; }

    // 2. DOWNLOAD FUNCTION
    async function triggerDownload(url, title) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = `PS-${title || 'Image'}.jpg`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) { window.open(url, '_blank'); }
    }

    // 3. LOAD GALLERY
    function loadGallery() {
      const container = document.getElementById('galleryContainer');
      db.collection("church_gallery").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
        if(snapshot.empty) {
          container.innerHTML = `<p style="text-align:center; grid-column:1/-1;">No images found.</p>`;
          return;
        }

        container.innerHTML = snapshot.docs.map(doc => {
          const photo = doc.data();
          const cap = photo.cap || 'Power Sanctuary';
          return `
            <div class="gallery-item">
              <img src="${photo.url}" onclick="openLightbox('${photo.url}', '${cap}')" onerror="this.src='https://placehold.co/600x400?text=Reloading+Image...'">
              <div class="item-footer">
                <span>${cap}</span>
                <div class="btn-group">
                   <button class="btn-action" onclick="openLightbox('${photo.url}', '${cap}')" title="View Image">
                    <i class="fa fa-eye"></i>
                  </button>
                  <button class="btn-action" onclick="triggerDownload('${photo.url}', '${cap}')" title="Download">
                    <i class="fa fa-download"></i>
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      });
    }

    window.onload = loadGallery;
  </script>
</body>
</html>
