<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Gallery | Power Sanctuary</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #050a18; 
      --accent: #c5a059;  
      --bg: #f4f7fa;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--primary); min-height: 100vh; }

    /* --- NAV --- */
    nav {
      background: var(--primary); padding: 20px 8%;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 1000;
    }
    .logo-text h1 { font-family: 'Playfair Display', serif; color: var(--accent); font-size: 1.4rem; }

    /* --- GRID --- */
    .gallery-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 25px; padding: 50px 8%;
    }
    .gallery-item {
      background: white; border-radius: 15px; overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06); transition: 0.3s;
    }
    .img-container { position: relative; width: 100%; height: 260px; cursor: pointer; }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; }

    .item-footer { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
    .item-footer span { font-weight: 600; font-size: 0.85rem; color: #444; }

    .actions { display: flex; gap: 10px; }
    .btn-action {
      width: 38px; height: 38px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      transition: 0.3s; border: none; cursor: pointer; font-size: 0.9rem;
    }
    .btn-view { background: #f0f4f8; color: var(--primary); }
    .btn-dl { background: #fff9eb; color: #b48a3d; border: 1px solid #f2e1c1; }
    .btn-dl:hover { background: var(--accent); color: var(--primary); }

    /* --- LIGHTBOX STYLES --- */
    #lightbox {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(5, 10, 24, 0.95);
      display: none; justify-content: center; align-items: center;
      z-index: 2000; padding: 20px;
    }
    #lightbox img { max-width: 90%; max-height: 80vh; border-radius: 10px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
    #lightbox .close { position: absolute; top: 30px; right: 30px; color: white; font-size: 2rem; cursor: pointer; }
    #lightbox .caption { position: absolute; bottom: 40px; color: var(--accent); font-weight: 600; font-size: 1.2rem; }
  </style>
</head>
<body>

  <nav>
    <div class="logo-text"><h1>POWER SANCTUARY</h1></div>
  </nav>

  <div class="gallery-grid" id="galleryContainer"></div>

  <div id="lightbox" onclick="closeLightbox()">
    <span class="close">&times;</span>
    <img id="lightboxImg" src="">
    <div class="caption" id="lightboxCap"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDew-adannENogn9S01WB5QY10Q11eJAy0",
      authDomain: "rccgpowersanctuaryarea.firebaseapp.com",
      projectId: "rccgpowersanctuaryarea",
      storageBucket: "rccgpowersanctuaryarea.firebasestorage.app",
      messagingSenderId: "189635943022",
      appId: "1:189635943022:web:daa6cace786eb3de9a247f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // LIGHTBOX LOGIC
    function openLightbox(url, cap) {
      document.getElementById('lightboxImg').src = url;
      document.getElementById('lightboxCap').innerText = cap;
      document.getElementById('lightbox').style.display = 'flex';
    }

    function closeLightbox() {
      document.getElementById('lightbox').style.display = 'none';
    }

    // DOWNLOAD LOGIC
    async function triggerDownload(url, title) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = `PS-${title.replace(/\s+/g, '-')}.jpg`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) { window.open(url, '_blank'); }
    }

    // LOAD DATA
    db.collection("church_gallery").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
      const container = document.getElementById('galleryContainer');
      container.innerHTML = snapshot.docs.map(doc => {
        const photo = doc.data();
        const title = photo.cap || 'Moment of Grace';
        return `
          <div class="gallery-item">
            <div class="img-container" onclick="openLightbox('${photo.url}', '${title}')">
              <img src="${photo.url}" alt="${title}">
            </div>
            <div class="item-footer">
              <span>${title}</span>
              <div class="actions">
                <button class="btn-action btn-view" onclick="openLightbox('${photo.url}', '${title}')">
                  <i class="fa fa-eye"></i>
                </button>
                <button onclick="triggerDownload('${photo.url}', '${title}')" class="btn-action btn-dl">
                  <i class="fa fa-download"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    });
  </script>
</body>
</html>
